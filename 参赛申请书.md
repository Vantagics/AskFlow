# 全员AI创智大赛 — 参赛申请书

## 一、作品基本信息

| 项目 | 内容 |
|------|------|
| 作品名称 | 问渠 AskFlow — 智能客服知识库系统 |
| 选题类别 | 产品能力/安全服务能力加强 — AI产品咨询小助手 |
| 作品形态 | Web Agent（提供可访问的 URL，含登录与使用指南） |
| 参赛方式 | 团队参赛（AskFlow 开源小组） |

---

## 二、作品概述

问渠 AskFlow 是一款基于 RAG（检索增强生成）技术的智能客服知识库系统。系统支持将产品文档（PDF、Word、Excel、PPT、Markdown）、视频（MP4/AVI/MKV/MOV/WebM）上传至知识库，用户提问时自动检索相关内容并通过大语言模型生成准确回答，附带来源引用和视频时间定位。

系统采用 Go 语言开发，单二进制部署，SQLite 存储，开箱即用。前端为 SPA 单页应用，支持中英文双语界面。

---

## 三、场景价值（50%）

### 3.1 解决的核心痛点

在日常工作中，产品咨询和技术支持面临以下问题：

1. 产品文档分散在多个系统中，客服人员查找效率低
2. 新员工上手慢，需要反复请教老员工
3. 重复性问题占用大量人力，无法聚焦高价值工作
4. 多产品线场景下，知识库混杂导致回答不准确
5. 视频教程内容无法被文本检索覆盖

### 3.2 应用场景

- 产品技术支持与售后客服：客户自助查询产品使用方法，减少人工客服压力
- 内部知识库问答：新员工快速获取产品知识，缩短培训周期
- 多产品线管理：每个产品拥有独立知识库，避免信息混淆
- 视频教程检索：上传产品演示视频，用户提问时返回精确到秒的视频片段

### 3.3 实际效果

- 通过 3 级文本匹配机制，重复问题可零 API 开销直接返回，大幅降低运营成本
- 多产品隔离检索确保回答准确性，避免跨产品信息干扰
- 待处理问题自动排队机制，管理员回答后自动入库，知识库持续积累
- 支持图片问答，用户可粘贴截图提问，系统通过视觉 LLM 结合知识库生成回答

---

## 四、功能完整性与易用性（30%）

### 4.1 核心功能

#### 智能问答（RAG 管线）
- 意图分类 → 向量检索 → LLM 生成回答，附带来源引用
- 支持文本、图片、视频三种模态的跨模态检索
- 3 级文本匹配：Level 1 本地文本匹配（零 API 开销）→ Level 2 向量确认 + 缓存复用（仅 Embedding）→ Level 3 完整 RAG（Embedding + LLM），逐级递进节省 API 成本

#### 多模态检索
- 文本向量化检索：将问题和文档分块转为向量，余弦相似度匹配
- 图片问答：用户粘贴图片提问，系统通过视觉 LLM 结合知识库生成回答
- 视频检索：上传视频后自动提取音频转录（whisper）和关键帧（ffmpeg），支持语义检索并返回精确时间定位

#### 多产品支持
- 管理多个产品线，每个产品拥有独立知识库
- 支持公共知识库跨产品共享
- 产品隔离检索：用户提问时仅在所选产品知识库和公共库中检索
- 每个产品可设置独立的欢迎信息

#### 多格式文档管理
- 支持 PDF、Word、Excel、PPT、Markdown、视频上传与解析
- URL 导入：通过 URL 抓取网页内容入库
- 命令行批量导入：递归扫描目录，支持指定目标产品
- 内容去重：文档级 SHA-256 哈希去重 + 分块级向量复用

#### 知识条目管理
- 管理员可直接添加文本 + 图片知识条目，按产品分类
- 待处理问题：无法回答的问题自动排队，管理员回答后自动入库

#### 用户认证与权限
- OAuth 2.0（Google / Apple / Amazon / Facebook）+ 邮箱密码注册
- 超级管理员 + 子管理员（编辑角色），支持按产品分配管理权限
- 数学验证码 + 邮箱验证，安全可靠

#### 系统管理
- Web 界面配置热重载，修改 LLM / Embedding / SMTP 等配置无需重启
- API Key 使用 AES-256-GCM 加密存储
- 数据备份与恢复：支持全量和增量两种模式，按数据类型分层备份

### 4.2 易用性

- Go 单二进制部署，无外部依赖，开箱即用
- 中英文双语界面，自动适配用户语言
- 完整的 RESTful API，便于集成
- 命令行工具支持批量导入、备份恢复等运维操作

---

## 五、创新性（20%）

### 5.1 向量检索性能优化（20 项技术创新）

本系统在向量检索模块实现了四个层级共 20 项性能优化技术，在有限硬件条件下实现全速运行：

#### 指令级优化（AVX-512 / AVX2 / SSE / ARM NEON SIMD 加速，7 项）
- 使用 Plan 9 汇编实现 AVX-512 向量点积运算，512-bit ZMM 寄存器，每次迭代处理 64 个 float32，实测加速比 8.8x
- AVX2+FMA 256-bit 路径，每次迭代处理 32 个 float32，实测加速比 8.6x
- ARM NEON+FMLA 128-bit 路径，支持 ARM 服务器和 Apple Silicon，加速比 ~4x
- SSE 128-bit 回退路径，兼容所有 x86-64 CPU
- SQRTSD 硬件平方根指令，消除函数调用开销
- 运行时 CPUID 自动检测，四级回退策略（AVX-512 → AVX2+FMA → SSE → 纯 Go）

实测性能（AMD Ryzen 7 7840H）：

| 向量维度 | 纯 Go 循环 | 8-way 展开 | AVX2+FMA | AVX-512 | 总加速比 |
|---------|-----------|-----------|----------|---------|---------|
| 768 维 | ~600 ns | 309 ns | 36 ns | 34.6 ns | 17.3x |
| 1536 维 | ~1200 ns | 593 ns | 70.7 ns | 67.3 ns | 17.8x |
| 3072 维 | ~2400 ns | 1162 ns | 135 ns | 128.9 ns | 18.6x |

#### 向量存储层优化（10 项）
- 连续内存 Arena：所有向量存储在一个连续 `[]float32` 大数组中，CPU 预取器可有效预测顺序访问，L1/L2 cache 命中率大幅提升
- Float32 内存表示：内存占用减半（10K 个 1536 维向量：60MB vs 120MB）
- Product 分区索引：按产品预分区，搜索范围缩小到目标产品 + 公共库
- 8-way 循环展开：8 个独立累加器打破依赖链，CPU 超标量执行单元并行处理
- Per-Worker 内联 Min-Heap Top-K：O(N log K) 复杂度，手写 sift-up/sift-down 完全内联，消除 `container/heap` 的 interface{} 装箱开销
- 自适应 Worker 数量：根据数据量动态调整并发度，避免小数据集 goroutine 开销
- FNV-1a 快速缓存哈希：零内存分配的 cache key 计算
- LRU 查询结果缓存：256 条容量、5 分钟 TTL，重复查询零计算开销
- 预计算 Text Bigrams：TextSearch 从 O(N × M) 降到 O(N × |query_bigrams|)

#### 查询引擎层优化
- Embedding API 结果缓存：512 条容量、10 分钟 TTL，重复问题零 API 延迟
- 批量 SQL 查询视频时间信息：N 次查询降到 1 次

#### 序列化层优化
- Float32 直接反序列化：消除 float32 → float64 → float32 的无意义转换

#### 端到端搜索性能估算（1536 维，8 核 CPU）

| 数据规模 | 原始实现 | 全部优化后 | 总加速比 |
|---------|---------|-----------|---------|
| 1K chunks | ~1.2ms | ~0.03ms | ~40x |
| 10K chunks | ~12ms | ~0.1ms | ~120x |
| 100K chunks | ~120ms | ~0.7ms | ~170x |

### 5.2 3 级文本匹配（API 成本优化）

创新性地引入三级递进匹配策略，在保证回答质量的同时最大限度降低 API 调用成本：

1. Level 1 — 本地文本匹配（零 API 开销）：使用字符 bigram 相似度在分块缓存中搜索
2. Level 2 — 向量确认 + 缓存复用（仅 Embedding API）：调用 Embedding 生成向量确认
3. Level 3 — 完整 RAG（Embedding + LLM）：前两级未命中时进入完整流程

### 5.3 多模态视频检索

将视频内容拆解为两种可检索形态——音频转录文本和关键帧图像——复用现有的 chunker → embedding → vectorstore 管线进行索引和检索，检索结果返回精确到秒的视频时间定位。

### 5.4 AI 辅助开发

本项目在开发过程中深度使用 AI 辅助工具（Kiro IDE），通过 Spec 驱动开发模式（需求文档 → 设计文档 → 实施任务）实现了高效的功能迭代。视频检索、多产品支持等核心功能均通过 AI 辅助完成需求分析、架构设计和代码实现。

---

## 六、技术架构

```
┌─────────────────────────────────────────────────────┐
│                   前端 SPA（中英文双语）               │
└──────────────────────┬──────────────────────────────┘
                       │ HTTP API
┌──────────────────────▼──────────────────────────────┐
│                   Go HTTP Server                     │
│  ┌─────────┐ ┌──────────┐ ┌────────┐ ┌───────────┐ │
│  │  Auth   │ │ Document │ │ Query  │ │  Product  │ │
│  │ (OAuth  │ │ Manager  │ │ Engine │ │  Service  │ │
│  │ Session)│ │          │ │ (RAG)  │ │           │ │
│  └─────────┘ └────┬─────┘ └───┬────┘ └───────────┘ │
│  ┌─────────┐ ┌────▼─────┐ ┌──▼─────┐ ┌───────────┐ │
│  │ Parser  │ │ Chunker  │ │Embedding│ │   LLM     │ │
│  │(多格式) │ │(512/128) │ │(文本+图片)│ │(含视觉模型)│ │
│  └─────────┘ └──────────┘ └────┬────┘ └───────────┘ │
│  ┌─────────┐                   │                     │
│  │ Video   │    SIMD 加速层     │                     │
│  │ Parser  │ (AVX-512/AVX2/   │                     │
│  │         │  NEON/SSE/Go)    │                     │
│  └─────────┘                   │                     │
│              ┌─────────────────▼──────────────────┐  │
│              │     SQLite + Vector Store           │  │
│              │  (WAL + Arena 内存 + 余弦相似度)     │  │
│              └────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

| 组件 | 技术选型 |
|------|----------|
| 后端 | Go 1.25+ |
| 数据库 | SQLite（WAL 模式，外键约束） |
| 向量存储 | SQLite 持久化 + 内存 Arena 缓存，SIMD 加速余弦相似度检索（AVX-512/AVX2/ARM NEON/SSE 四级回退） |
| LLM | OpenAI 兼容 Chat Completion API（支持视觉模型） |
| Embedding | OpenAI 兼容 Embedding API（支持多模态：文本 + 图片） |
| 视频处理 | ffmpeg + whisper |
| 认证 | OAuth 2.0 + bcrypt + Session |
| 加密 | AES-256-GCM |

---

## 七、演示说明

### 访问方式
- 提供可访问的 Web URL
- 浏览器直接访问，无需安装客户端

### 演示流程
1. 管理员登录 → 创建产品 → 上传文档/视频
2. 用户端提问 → 系统自动检索 → 生成带来源引用的回答
3. 图片问答演示：粘贴产品截图提问
4. 视频检索演示：提问匹配视频内容，返回精确时间定位
5. 待处理问题：无法回答时自动排队，管理员回答后自动入库

---

## 八、总结

问渠 AskFlow 是一款功能完整、技术创新的智能客服知识库系统。在场景价值上，它解决了产品咨询中文档分散、重复问题消耗人力、多产品知识混杂等核心痛点；在技术创新上，它实现了 20 项向量检索性能优化（含 AVX-512/AVX2/ARM NEON 多架构 SIMD 汇编加速，实测最高 18.6x 加速比）、3 级文本匹配 API 成本优化、多模态视频检索等差异化能力；在易用性上，Go 单二进制部署、开箱即用、中英文双语界面，降低了使用门槛。
