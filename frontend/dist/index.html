<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>软件自助服务平台</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div id="app">
        <!-- Login Page -->
        <div id="page-login" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1>软件自助服务平台</h1>
                    </div>

                    <!-- Login Form -->
                    <div id="user-login-form" class="admin-login-form">
                        <p class="login-subtitle" style="text-align:center;margin-bottom:1rem;">登录您的账号</p>
                        <div class="input-group">
                            <input type="email" id="user-login-email" placeholder="邮箱" autocomplete="email">
                            <input type="password" id="user-login-password" placeholder="密码" autocomplete="current-password">
                            <div class="captcha-row">
                                <input type="text" id="user-login-captcha" placeholder="验证码答案" autocomplete="off" class="captcha-input">
                                <span id="user-login-captcha-question" class="captcha-question" onclick="loadLoginCaptcha()"></span>
                            </div>
                            <button class="admin-submit-btn" onclick="handleUserLogin()">登录</button>
                        </div>
                        <p id="user-login-error" class="error-text hidden"></p>
                        <p class="auth-switch">还没有账号？<a href="javascript:void(0)" onclick="showRegisterForm()">注册</a></p>
                    </div>

                    <!-- Register Form -->
                    <div id="user-register-form" class="admin-login-form hidden">
                        <p class="login-subtitle" style="text-align:center;margin-bottom:1rem;">创建新账号</p>
                        <div class="input-group">
                            <input type="text" id="user-register-name" placeholder="昵称" autocomplete="name">
                            <input type="email" id="user-register-email" placeholder="邮箱" autocomplete="email">
                            <input type="password" id="user-register-password" placeholder="密码（至少6位）" autocomplete="new-password">
                            <input type="password" id="user-register-password-confirm" placeholder="确认密码" autocomplete="new-password">
                            <div class="captcha-row">
                                <input type="text" id="user-register-captcha" placeholder="验证码答案" autocomplete="off" class="captcha-input">
                                <span id="user-register-captcha-question" class="captcha-question" onclick="loadRegisterCaptcha()"></span>
                            </div>
                            <button class="admin-submit-btn" onclick="handleUserRegister()">注册</button>
                        </div>
                        <p id="user-register-error" class="error-text hidden"></p>
                        <p id="user-register-success" class="success-text hidden"></p>
                        <p class="auth-switch">已有账号？<a href="javascript:void(0)" onclick="showLoginForm()">登录</a></p>
                    </div>
                </div>

                <div id="login-toast" class="toast hidden"></div>
            </div>
        </div>

        <!-- Verify Email Page -->
        <div id="page-verify" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1>邮箱验证</h1>
                    </div>
                    <div id="verify-status" style="text-align:center;padding:1rem;">
                        <p>正在验证...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Login Page (hidden URL) -->
        <div id="page-admin-login" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1>管理员登录</h1>
                    </div>

                    <div id="admin-login-form" class="admin-login-form hidden">
                        <div class="input-group">
                            <input type="text" id="admin-username" placeholder="管理员用户名" autocomplete="username">
                            <input type="password" id="admin-password" placeholder="管理员密码" autocomplete="current-password">
                            <button class="admin-submit-btn" onclick="handleAdminLogin()">登录</button>
                        </div>
                        <p id="admin-login-error" class="error-text hidden"></p>
                    </div>
                    <div id="admin-setup-form" class="admin-login-form hidden">
                        <p class="setup-hint">首次使用，请设置管理员账号</p>
                        <div class="input-group">
                            <input type="text" id="admin-setup-username" placeholder="设置管理员用户名" autocomplete="username">
                            <input type="password" id="admin-setup-password" placeholder="设置管理员密码" autocomplete="new-password">
                            <input type="password" id="admin-setup-password-confirm" placeholder="确认密码" autocomplete="new-password">
                            <button class="admin-submit-btn" onclick="handleAdminSetup()">创建管理员</button>
                        </div>
                        <p id="admin-setup-error" class="error-text hidden"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Page -->
        <div id="page-chat" class="page hidden">
            <div class="chat-layout">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-header-left">
                        <svg width="28" height="28" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="chat-header-title">软件自助服务平台</span>
                    </div>
                    <div class="chat-header-right">
                        <span id="chat-user-name" class="chat-user-name"></span>
                        <button id="chat-login-btn" class="chat-logout-btn hidden" onclick="navigate('/login')">登录</button>
                        <button id="chat-logout-btn" class="chat-logout-btn hidden" onclick="logout()">退出登录</button>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-welcome">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5" opacity="0.1"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h3>欢迎使用软件自助服务平台</h3>
                        <p>请输入您的问题，我将为您查找相关资料并提供解答。</p>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div id="chat-image-preview" class="chat-image-preview hidden">
                        <img id="chat-image-preview-img" src="" alt="预览">
                        <button class="chat-image-remove" onclick="removeChatImage()" title="移除图片">&times;</button>
                    </div>
                    <div class="chat-input-wrapper">
                        <textarea id="chat-input" class="chat-input" placeholder="输入您的问题...（可粘贴图片）" rows="1"></textarea>
                        <button id="chat-send-btn" class="chat-send-btn" onclick="sendChatMessage()" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="page-admin" class="page hidden">
            <div class="admin-layout">
                <!-- Sidebar -->
                <aside class="admin-sidebar">
                    <div class="admin-sidebar-header">
                        <svg width="28" height="28" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>管理面板</span>
                    </div>
                    <nav class="admin-nav">
                        <button class="admin-nav-item active" data-tab="documents" onclick="switchAdminTab('documents')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            <span>文档管理</span>
                        </button>
                        <button class="admin-nav-item" data-tab="pending" onclick="switchAdminTab('pending')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span>待回答问题</span>
                        </button>
                        <button class="admin-nav-item" data-tab="knowledge" onclick="switchAdminTab('knowledge')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                            <span>知识录入</span>
                        </button>
                        <button class="admin-nav-item" data-tab="settings" onclick="switchAdminTab('settings')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                            <span>系统设置</span>
                        </button>
                        <button class="admin-nav-item" data-tab="users" onclick="switchAdminTab('users')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                            <span>用户管理</span>
                        </button>
                    </nav>
                    <div class="admin-sidebar-footer">
                        <button class="admin-logout-btn" onclick="logout()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                            <span>退出登录</span>
                        </button>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="admin-main">
                    <!-- Documents Tab -->
                    <div id="admin-tab-documents" class="admin-tab">
                        <div class="admin-tab-header">
                            <h2>文档管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <!-- Upload Area -->
                            <div class="admin-upload-section">
                                <div id="admin-drop-zone" class="admin-drop-zone" onclick="document.getElementById('admin-file-input').click()">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                    <p>拖拽文件到此处，或点击选择文件</p>
                                    <span class="admin-drop-hint">支持 PDF、Word、Excel、PPT、Markdown 格式</span>
                                    <input type="file" id="admin-file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.md,.markdown" style="display:none" onchange="handleAdminFileUpload(this)">
                                </div>
                                <div class="admin-url-input">
                                    <input type="text" id="admin-url-field" placeholder="输入文档URL地址">
                                    <button class="btn-primary" onclick="handleAdminURLSubmit()">提交URL</button>
                                </div>
                            </div>

                            <!-- Document List -->
                            <div class="admin-doc-list-section">
                                <h3>文档列表</h3>
                                <div id="admin-doc-table-wrap">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>文档名称</th>
                                                <th>文件类型</th>
                                                <th>处理状态</th>
                                                <th>上传时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-doc-tbody">
                                            <tr><td colspan="5" class="admin-table-empty">暂无文档</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Questions Tab -->
                    <div id="admin-tab-pending" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2>待回答问题</h2>
                            <div class="admin-filter-group">
                                <button class="admin-filter-btn active" data-status="" onclick="filterPendingQuestions('')">全部</button>
                                <button class="admin-filter-btn" data-status="pending" onclick="filterPendingQuestions('pending')">待回答</button>
                                <button class="admin-filter-btn" data-status="answered" onclick="filterPendingQuestions('answered')">已回答</button>
                            </div>
                        </div>
                        <div class="admin-tab-body">
                            <div id="admin-pending-list" class="admin-pending-list">
                                <div class="admin-table-empty">暂无问题</div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="admin-tab-settings" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2>系统设置</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div id="admin-settings-form" class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend>服务端口</legend>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>HTTP 端口</label>
                                            <input type="number" id="cfg-server-port" min="1" max="65535" placeholder="8080">
                                            <span class="admin-form-hint">修改端口后需重启服务才能生效</span>
                                        </div>
                                        <div style="display:flex;align-items:flex-end;">
                                            <button class="btn-secondary" id="server-restart-btn" onclick="restartServer()">重启服务</button>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>LLM 配置</legend>
                                    <div class="admin-form-row">
                                        <label>LLM 端点</label>
                                        <input type="text" id="cfg-llm-endpoint" placeholder="https://api.openai.com/v1">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>LLM 模型</label>
                                        <input type="text" id="cfg-llm-model" placeholder="gpt-4">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>API 密钥</label>
                                        <input type="password" id="cfg-llm-apikey" placeholder="***">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>温度</label>
                                            <input type="number" id="cfg-llm-temperature" step="0.1" min="0" max="2" placeholder="0.3">
                                        </div>
                                        <div>
                                            <label>最大 Token</label>
                                            <input type="number" id="cfg-llm-maxtokens" min="1" placeholder="2048">
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>Embedding 配置</legend>
                                    <div class="admin-form-row">
                                        <label>Embedding 端点</label>
                                        <input type="text" id="cfg-emb-endpoint" placeholder="https://api.openai.com/v1">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>Embedding 模型</label>
                                        <input type="text" id="cfg-emb-model" placeholder="text-embedding-3-small">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>API 密钥</label>
                                        <div class="input-with-btn">
                                            <input type="password" id="cfg-emb-apikey" placeholder="***">
                                            <a href="https://console.volcengine.com/ark/" target="_blank" rel="noopener noreferrer" class="btn-secondary btn-sm">获取 API Key</a>
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label>多模态嵌入</label>
                                        <select id="cfg-emb-multimodal">
                                            <option value="false">否（标准 /embeddings）</option>
                                            <option value="true">是（/embeddings/multimodal）</option>
                                        </select>
                                        <span class="admin-form-hint">豆包视觉嵌入模型需开启此选项</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>向量配置</legend>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>分块大小</label>
                                            <input type="number" id="cfg-vec-chunksize" min="1" placeholder="512">
                                        </div>
                                        <div>
                                            <label>重叠大小</label>
                                            <input type="number" id="cfg-vec-overlap" min="0" placeholder="128">
                                        </div>
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>Top-K</label>
                                            <input type="number" id="cfg-vec-topk" min="1" placeholder="5">
                                        </div>
                                        <div>
                                            <label>相似度阈值</label>
                                            <input type="number" id="cfg-vec-threshold" step="0.01" min="0" max="1" placeholder="0.7">
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>邮件服务器 (SMTP)</legend>
                                    <div class="admin-form-row">
                                        <label>SMTP 服务器</label>
                                        <input type="text" id="cfg-smtp-host" placeholder="smtp.example.com">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>端口</label>
                                            <input type="number" id="cfg-smtp-port" placeholder="587">
                                        </div>
                                        <div>
                                            <label>使用 TLS</label>
                                            <select id="cfg-smtp-tls">
                                                <option value="true">是</option>
                                                <option value="false">否</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label>用户名</label>
                                        <input type="text" id="cfg-smtp-username" placeholder="user@example.com">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>密码</label>
                                        <input type="password" id="cfg-smtp-password" placeholder="***">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label>发件人地址</label>
                                            <input type="text" id="cfg-smtp-from-addr" placeholder="noreply@example.com">
                                        </div>
                                        <div>
                                            <label>发件人名称</label>
                                            <input type="text" id="cfg-smtp-from-name" placeholder="软件自助服务平台">
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label>测试发送</label>
                                        <div style="display:flex;gap:0.5rem;">
                                            <input type="email" id="cfg-smtp-test-email" placeholder="收件人邮箱" style="flex:1;">
                                            <button class="btn-secondary" id="smtp-test-btn" onclick="testSmtpEmail()">发送测试邮件</button>
                                        </div>
                                        <p id="smtp-test-result" class="hidden" style="margin-top:0.5rem;font-size:0.85rem;"></p>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>管理员设置</legend>
                                    <div class="admin-form-row">
                                        <label>管理员登录路由</label>
                                        <input type="text" id="cfg-admin-login-route" placeholder="/admin">
                                        <span class="admin-form-hint">访问此隐藏路由可进入管理员登录页面</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend>产品介绍</legend>
                                    <div class="admin-form-row">
                                        <label>欢迎信息</label>
                                        <textarea id="cfg-product-intro" rows="4" placeholder="输入产品简介，用户登录后将作为欢迎信息显示"></textarea>
                                        <span class="admin-form-hint">用户登录后在聊天页面显示此信息</span>
                                    </div>
                                </fieldset>

                                <div class="admin-form-actions">
                                    <button class="btn-primary" onclick="saveAdminSettings()">保存设置</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Knowledge Entry Tab -->
                    <div id="admin-tab-knowledge" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2>知识录入</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend>录入图文知识</legend>
                                    <div class="admin-form-row">
                                        <label>标题</label>
                                        <input type="text" id="knowledge-title" placeholder="知识条目标题">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>内容</label>
                                        <textarea id="knowledge-content" rows="6" placeholder="输入知识内容（支持详细描述）"></textarea>
                                    </div>
                                    <div class="admin-form-row">
                                        <label>图片（可选）</label>
                                        <div id="knowledge-image-zone" class="knowledge-image-zone">
                                            <div class="knowledge-image-upload-area" id="knowledge-image-upload-area">
                                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                                                <p>点击上传图片、拖拽图片到此处，或从剪贴板粘贴</p>
                                                <span class="admin-drop-hint">支持 JPG、PNG、GIF、WebP、BMP 格式</span>
                                                <input type="file" id="knowledge-image-input" accept="image/*" multiple style="display:none">
                                            </div>
                                            <div id="knowledge-image-preview" class="knowledge-image-preview"></div>
                                        </div>
                                    </div>
                                </fieldset>
                                <div class="admin-form-actions">
                                    <button class="btn-primary" id="knowledge-submit-btn" onclick="submitKnowledgeEntry()">提交录入</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Users Tab -->
                    <div id="admin-tab-users" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2>用户管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend>添加管理员账号</legend>
                                    <div class="admin-form-row">
                                        <label>用户名</label>
                                        <input type="text" id="admin-new-username" placeholder="用户名">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>密码</label>
                                        <input type="password" id="admin-new-password" placeholder="密码（至少6位）">
                                    </div>
                                    <div class="admin-form-row">
                                        <label>角色</label>
                                        <select id="admin-new-role">
                                            <option value="editor">编辑员（内容管理/问题回答）</option>
                                            <option value="super_admin">超级管理员（全部权限）</option>
                                        </select>
                                        <span class="admin-form-hint">编辑员仅可管理文档、回答问题和录入知识，不能修改系统设置和管理用户</span>
                                    </div>
                                    <div class="admin-form-actions">
                                        <button class="btn-primary" onclick="createAdminUser()">添加用户</button>
                                    </div>
                                </fieldset>
                                <fieldset class="admin-fieldset">
                                    <legend>管理员账号列表</legend>
                                    <div id="admin-users-table-wrap">
                                        <table class="admin-table">
                                            <thead>
                                                <tr>
                                                    <th>用户名</th>
                                                    <th>角色</th>
                                                    <th>创建时间</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-users-tbody">
                                                <tr><td colspan="4" class="admin-table-empty">暂无子账号</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Delete Confirmation Dialog -->
            <div id="admin-confirm-dialog" class="admin-dialog-overlay hidden">
                <div class="admin-dialog">
                    <h3>确认删除</h3>
                    <p id="admin-confirm-msg">确定要删除该文档吗？此操作不可撤销。</p>
                    <div class="admin-dialog-actions">
                        <button class="btn-secondary" onclick="closeAdminDialog()">取消</button>
                        <button class="btn-danger" id="admin-confirm-btn" onclick="confirmAdminDelete()">删除</button>
                    </div>
                </div>
            </div>

            <!-- Answer Dialog -->
            <div id="admin-answer-dialog" class="admin-dialog-overlay hidden">
                <div class="admin-dialog admin-dialog-wide">
                    <h3>回答问题</h3>
                    <div class="admin-answer-question" id="admin-answer-question-text"></div>
                    <div class="admin-form-row">
                        <label>文字回答</label>
                        <textarea id="admin-answer-text" rows="4" placeholder="输入回答内容"></textarea>
                    </div>
                    <div class="admin-form-row">
                        <label>图片（可选，支持粘贴/拖拽/点击上传）</label>
                        <div id="answer-image-upload-area" class="upload-area upload-area-sm">
                            <input type="file" id="answer-image-input" accept="image/*" multiple hidden>
                            <span>点击选择图片，或拖拽/粘贴图片到此处</span>
                        </div>
                        <div id="answer-image-preview" class="knowledge-image-preview"></div>
                    </div>
                    <div class="admin-form-row">
                        <label>相关URL（可选）</label>
                        <input type="text" id="admin-answer-url" placeholder="https://...">
                    </div>
                    <div class="admin-dialog-actions">
                        <button class="btn-secondary" onclick="closeAnswerDialog()">取消</button>
                        <button class="btn-primary" id="admin-answer-submit-btn" onclick="submitAdminAnswer()">提交回答</button>
                    </div>
                </div>
            </div>

            <div id="admin-toast" class="toast hidden"></div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
