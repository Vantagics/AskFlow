<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>软件自助服务平台</title>
    <link rel="stylesheet" href="/styles.css?v=20260212-4">
    <script src="/i18n.js?v=20260212-4"></script>
</head>
<body>
    <div id="app">
        <!-- System Setup Page (shown when API keys not configured) -->
        <div id="page-setup" class="page hidden">
            <div class="login-container">
                <div class="login-card" style="text-align:center;">
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#F59E0B"/>
                                <path d="M24 14v12M24 30h.01M14 34h20a2 2 0 002-2V16a2 2 0 00-2-2H14a2 2 0 00-2 2v16a2 2 0 002 2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1 data-i18n="setup_title">系统启动准备中</h1>
                    </div>
                    <p style="color:#6b7280;margin:1.5rem 0;font-size:1.05rem;line-height:1.7;" data-i18n="setup_message">系统启动准备中，请稍后...</p>
                    <p style="color:#9ca3af;font-size:0.9rem;" data-i18n="setup_hint">管理员正在配置系统，配置完成后即可正常使用。</p>
                    <button class="admin-submit-btn" style="margin-top:1.5rem;" onclick="location.reload()" data-i18n="setup_refresh">刷新页面</button>
                </div>
            </div>
        </div>

        <!-- Login Page -->
        <div id="page-login" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <button id="lang-switch-login" class="lang-switch-btn lang-switch-corner" onclick="i18n.toggleLang(); i18n.applyI18nToPage();">EN</button>
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1 data-i18n="login_title" data-product-name>软件自助服务平台</h1>
                    </div>

                    <!-- Login Form -->
                    <div id="user-login-form" class="admin-login-form">
                        <p class="login-subtitle" style="text-align:center;margin-bottom:1rem;" data-i18n="login_subtitle">登录您的账号</p>

                        <!-- Product Selector -->
                        <div id="login-product-selector" class="login-product-selector hidden">
                            <select id="user-login-product" class="login-product-select">
                                <option value="" data-i18n="login_select_product">请选择产品</option>
                            </select>
                        </div>

                        <!-- OAuth Buttons (dynamically populated) -->
                        <div id="oauth-login-buttons" class="oauth-buttons hidden"></div>
                        <div id="oauth-login-divider" class="login-divider hidden"><span data-i18n="login_divider_or">或</span></div>

                        <div class="input-group">
                            <input type="email" id="user-login-email" data-i18n-placeholder="login_email" placeholder="邮箱" autocomplete="email">
                            <input type="password" id="user-login-password" data-i18n-placeholder="login_password" placeholder="密码" autocomplete="current-password">
                            <div class="captcha-row">
                                <input type="text" id="user-login-captcha" data-i18n-placeholder="login_captcha" placeholder="验证码答案" autocomplete="off" class="captcha-input">
                                <span id="user-login-captcha-question" class="captcha-question" onclick="loadLoginCaptcha()"></span>
                            </div>
                            <button class="admin-submit-btn" onclick="handleUserLogin()" data-i18n="login_btn">登录</button>
                        </div>
                        <p id="user-login-error" class="error-text hidden"></p>
                        <p class="auth-switch"><span data-i18n="login_no_account">还没有账号？</span><a href="javascript:void(0)" onclick="showRegisterForm()" data-i18n="login_register_link">注册</a></p>
                    </div>

                    <!-- Register Form -->
                    <div id="user-register-form" class="admin-login-form hidden">
                        <p class="login-subtitle" style="text-align:center;margin-bottom:1rem;" data-i18n="register_subtitle">创建新账号</p>
                        <div class="input-group">
                            <input type="text" id="user-register-name" data-i18n-placeholder="register_name" placeholder="昵称" autocomplete="name">
                            <input type="email" id="user-register-email" data-i18n-placeholder="register_email" placeholder="邮箱" autocomplete="email">
                            <input type="password" id="user-register-password" data-i18n-placeholder="register_password" placeholder="密码（至少6位）" autocomplete="new-password">
                            <input type="password" id="user-register-password-confirm" data-i18n-placeholder="register_password_confirm" placeholder="确认密码" autocomplete="new-password">
                            <div class="captcha-row">
                                <input type="text" id="user-register-captcha" data-i18n-placeholder="register_captcha" placeholder="验证码答案" autocomplete="off" class="captcha-input">
                                <span id="user-register-captcha-question" class="captcha-question" onclick="loadRegisterCaptcha()"></span>
                            </div>
                            <button class="admin-submit-btn" onclick="handleUserRegister()" data-i18n="register_btn">注册</button>
                        </div>
                        <p id="user-register-error" class="error-text hidden"></p>
                        <p id="user-register-success" class="success-text hidden"></p>
                        <p class="auth-switch"><span data-i18n="register_has_account">已有账号？</span><a href="javascript:void(0)" onclick="showLoginForm()" data-i18n="register_login_link">登录</a></p>
                    </div>
                </div>

                <div id="login-toast" class="toast hidden"></div>
            </div>
        </div>

        <!-- Verify Email Page -->
        <div id="page-verify" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1 data-i18n="verify_title">邮箱验证</h1>
                    </div>
                    <div id="verify-status" style="text-align:center;padding:1rem;">
                        <p data-i18n="verify_loading">正在验证...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Login Page (hidden URL) -->
        <div id="page-admin-login" class="page hidden">
            <div class="login-container">
                <div class="login-card">
                    <button class="lang-switch-btn lang-switch-corner" onclick="i18n.toggleLang(); i18n.applyI18nToPage();">EN</button>
                    <div class="login-header">
                        <div class="login-logo">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                                <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h1 data-i18n="admin_login_title">管理员登录</h1>
                    </div>

                    <div id="admin-login-form" class="admin-login-form hidden">
                        <div class="input-group">
                            <input type="text" id="admin-username" data-i18n-placeholder="admin_username" placeholder="管理员用户名" autocomplete="username">
                            <input type="password" id="admin-password" data-i18n-placeholder="admin_password" placeholder="管理员密码" autocomplete="current-password">
                            <div class="captcha-row">
                                <input type="text" id="admin-login-captcha" data-i18n-placeholder="admin_captcha" placeholder="验证码" autocomplete="off" class="captcha-input">
                                <img id="admin-login-captcha-img" class="captcha-img" alt="captcha" onclick="loadAdminCaptcha()" title="点击刷新">
                            </div>
                            <button class="admin-submit-btn" onclick="handleAdminLogin()" data-i18n="admin_login_btn">登录</button>
                        </div>
                        <p id="admin-login-error" class="error-text hidden"></p>
                    </div>
                    <div id="admin-setup-form" class="admin-login-form hidden">
                        <p class="setup-hint" data-i18n="admin_setup_hint">首次使用，请设置管理员账号</p>
                        <div class="input-group">
                            <input type="text" id="admin-setup-username" data-i18n-placeholder="admin_setup_username" placeholder="设置管理员用户名" autocomplete="username">
                            <input type="password" id="admin-setup-password" data-i18n-placeholder="admin_setup_password" placeholder="设置管理员密码" autocomplete="new-password">
                            <input type="password" id="admin-setup-password-confirm" data-i18n-placeholder="admin_setup_password_confirm" placeholder="确认密码" autocomplete="new-password">
                            <button class="admin-submit-btn" onclick="handleAdminSetup()" data-i18n="admin_setup_btn">创建管理员</button>
                        </div>
                        <p id="admin-setup-error" class="error-text hidden"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Page -->
        <div id="page-chat" class="page hidden">
            <div class="chat-layout">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-header-left">
                        <svg width="28" height="28" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="chat-header-title" data-i18n="chat_title" data-product-name>软件自助服务平台</span>
                    </div>
                    <div class="chat-header-right">
                        <button id="lang-switch-btn" class="lang-switch-btn" onclick="i18n.toggleLang(); i18n.applyI18nToPage();">EN</button>
                        <span id="chat-user-name" class="chat-user-name"></span>
                        <button id="chat-login-btn" class="chat-logout-btn hidden" onclick="navigate('/login')" data-i18n="chat_login_btn">登录</button>
                        <button id="chat-logout-btn" class="chat-logout-btn hidden" onclick="logout()" data-i18n="chat_logout_btn">退出登录</button>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-welcome">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5" opacity="0.1"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h3 data-i18n="chat_welcome_title" data-product-name-welcome>欢迎使用软件自助服务平台</h3>
                        <p data-i18n="chat_welcome_desc">请输入您的问题，我将为您查找相关资料并提供解答。</p>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div id="chat-image-preview" class="chat-image-preview hidden">
                        <img id="chat-image-preview-img" src="" alt="预览" data-i18n-title="chat_image_remove_title">
                        <button class="chat-image-remove" onclick="removeChatImage()" data-i18n-title="chat_image_remove_title" title="移除图片">&times;</button>
                    </div>
                    <div class="chat-input-wrapper" id="chat-input-wrapper">
                        <button class="chat-image-upload-btn" onclick="document.getElementById('chat-image-file-input').click()" data-i18n-title="chat_image_upload_title" title="上传图片">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <input type="file" id="chat-image-file-input" accept="image/*" style="display:none" onchange="handleChatImageFileSelect(this)">
                        </button>
                        <textarea id="chat-input" class="chat-input" data-i18n-placeholder="chat_input_placeholder" placeholder="输入您的问题...（可粘贴或上传图片）" rows="1"></textarea>
                        <button id="chat-send-btn" class="chat-send-btn" onclick="sendChatMessage()" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="page-admin" class="page hidden">
            <div class="admin-layout">
                <!-- Sidebar -->
                <aside class="admin-sidebar">
                    <div class="admin-sidebar-header">
                        <svg width="28" height="28" viewBox="0 0 48 48" fill="none">
                            <rect width="48" height="48" rx="12" fill="#4F46E5"/>
                            <path d="M16 20h16M16 24h12M16 28h14M14 16h20a2 2 0 012 2v12a2 2 0 01-2 2H14a2 2 0 01-2-2V18a2 2 0 012-2z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span data-i18n="admin_panel_title">管理面板</span>
                    </div>
                    <nav class="admin-nav">
                        <button class="admin-nav-item active" data-tab="documents" onclick="switchAdminTab('documents')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            <span data-i18n="admin_nav_documents">文档管理</span>
                        </button>
                        <button class="admin-nav-item" data-tab="pending" onclick="switchAdminTab('pending')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span data-i18n="admin_nav_pending">待回答问题</span>
                        </button>
                        <button class="admin-nav-item" data-tab="knowledge" onclick="switchAdminTab('knowledge')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                            <span data-i18n="admin_nav_knowledge">知识录入</span>
                        </button>
                        <button class="admin-nav-item" data-tab="products" onclick="switchAdminTab('products')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                            <span data-i18n="admin_nav_products">产品管理</span>
                        </button>
                        <button class="admin-nav-item" data-tab="multimodal" onclick="switchAdminTab('multimodal')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
                            <span data-i18n="admin_nav_multimodal">多模态</span>
                        </button>
                        <button class="admin-nav-item" data-tab="settings" onclick="switchAdminTab('settings')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                            <span data-i18n="admin_nav_settings">系统设置</span>
                        </button>
                        <button class="admin-nav-item" data-tab="users" onclick="switchAdminTab('users')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                            <span data-i18n="admin_nav_users">用户管理</span>
                        </button>
                        <button class="admin-nav-item" data-tab="bans" onclick="switchAdminTab('bans')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                            <span data-i18n="admin_nav_bans">登录限制</span>
                        </button>
                    </nav>
                    <div class="admin-sidebar-footer">
                        <div class="admin-user-info">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            <span id="admin-username-display" class="admin-username">--</span>
                        </div>
                        <button class="lang-switch-btn" style="margin-bottom:8px;width:100%;" onclick="i18n.toggleLang(); i18n.applyI18nToPage();">EN</button>
                        <button class="admin-logout-btn" onclick="adminLogout()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                            <span data-i18n="admin_sidebar_logout">退出登录</span>
                        </button>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="admin-main">
                    <!-- Documents Tab -->
                    <div id="admin-tab-documents" class="admin-tab">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_doc_title">文档管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <!-- Product Selector for Documents -->
                            <div class="admin-product-selector" style="margin-bottom:1rem;">
                                <label data-i18n="admin_doc_product_label" style="font-weight:500;margin-right:0.5rem;">目标产品：</label>
                                <select id="doc-product-select" class="login-product-select" style="width:auto;min-width:200px;display:inline-block;">
                                    <option value="" data-i18n="admin_doc_product_public">公共库</option>
                                </select>
                            </div>
                            <!-- Upload Area -->
                            <div class="admin-upload-section">
                                <div id="admin-drop-zone" class="admin-drop-zone" onclick="document.getElementById('admin-file-input').click()">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                    <p data-i18n="admin_doc_drop_text">拖拽文件到此处，或点击选择文件</p>
                                    <span class="admin-drop-hint" data-i18n="admin_doc_drop_hint">支持 PDF、Word、Excel、PPT、Markdown、视频格式</span>
                                    <input type="file" id="admin-file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.md,.markdown,.mp4,.avi,.mkv,.mov,.webm" style="display:none" onchange="handleAdminFileUpload(this)">
                                </div>
                                <div class="admin-url-input">
                                    <input type="text" id="admin-url-field" data-i18n-placeholder="admin_doc_url_placeholder" placeholder="输入文档URL地址">
                                    <button class="btn-primary" id="admin-url-preview-btn" onclick="handleAdminURLPreview()" data-i18n="admin_doc_url_preview">预览内容</button>
                                    <span id="admin-url-spinner" class="inline-spinner hidden"></span>
                                </div>
                                <div id="admin-url-preview-area" class="hidden" style="margin-top:0.75rem;">
                                    <div style="font-size:0.85rem;color:#6b7280;margin-bottom:0.5rem;" data-i18n="admin_doc_url_preview_hint">以下是从URL获取的内容预览，确认无误后点击提交：</div>
                                    <div id="admin-url-preview-content" style="max-height:300px;overflow-y:auto;border:1px solid #e5e7eb;border-radius:8px;padding:0.75rem;font-size:0.85rem;background:#f9fafb;white-space:pre-wrap;word-break:break-all;"></div>
                                    <div style="margin-top:0.5rem;display:flex;gap:0.5rem;align-items:center;">
                                        <button class="btn-primary" id="admin-url-confirm-btn" onclick="handleAdminURLConfirm()" data-i18n="admin_doc_url_confirm">确认提交</button>
                                        <button class="btn-secondary" onclick="handleAdminURLCancel()" data-i18n="admin_doc_url_cancel">取消</button>
                                        <span id="admin-url-confirm-spinner" class="inline-spinner hidden"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Document List -->
                            <div class="admin-doc-list-section">
                                <h3 data-i18n="admin_doc_list_title">文档列表</h3>
                                <div id="admin-doc-table-wrap">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th data-i18n="admin_doc_th_name">文档名称</th>
                                                <th data-i18n="admin_doc_th_product">所属产品</th>
                                                <th data-i18n="admin_doc_th_type">文件类型</th>
                                                <th data-i18n="admin_doc_th_status">处理状态</th>
                                                <th data-i18n="admin_doc_th_time">上传时间</th>
                                                <th data-i18n="admin_doc_th_action">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-doc-tbody">
                                            <tr><td colspan="6" class="admin-table-empty" data-i18n="admin_doc_empty">暂无文档</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Questions Tab -->
                    <div id="admin-tab-pending" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_pending_title">待回答问题</h2>
                            <div class="admin-filter-group">
                                <button class="admin-filter-btn active" data-status="" onclick="filterPendingQuestions('')" data-i18n="admin_pending_filter_all">全部</button>
                                <button class="admin-filter-btn" data-status="pending" onclick="filterPendingQuestions('pending')" data-i18n="admin_pending_filter_pending">待回答</button>
                                <button class="admin-filter-btn" data-status="answered" onclick="filterPendingQuestions('answered')" data-i18n="admin_pending_filter_answered">已回答</button>
                            </div>
                        </div>
                        <div class="admin-tab-body">
                            <div id="admin-pending-list" class="admin-pending-list">
                                <div class="admin-table-empty" data-i18n="admin_pending_empty">暂无问题</div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="admin-tab-settings" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_settings_title">系统设置</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div id="admin-settings-form" class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_server_port">服务端口</legend>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_http_port">HTTP 端口</label>
                                            <input type="number" id="cfg-server-port" min="1" max="65535" placeholder="8080">
                                            <span class="admin-form-hint" data-i18n="admin_settings_port_hint">修改端口后需重启服务才能生效</span>
                                        </div>
                                        <div style="display:flex;align-items:flex-end;">
                                            <button class="btn-secondary" id="server-restart-btn" onclick="restartServer()" data-i18n="admin_settings_restart">重启服务</button>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_llm">LLM 配置</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_llm_endpoint">LLM 端点</label>
                                        <input type="text" id="cfg-llm-endpoint" placeholder="https://api.openai.com/v1">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_llm_model">LLM 模型</label>
                                        <input type="text" id="cfg-llm-model" placeholder="gpt-4">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_api_key">API 密钥</label>
                                        <input type="password" id="cfg-llm-apikey" placeholder="***">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_temperature">温度</label>
                                            <input type="number" id="cfg-llm-temperature" step="0.1" min="0" max="2" placeholder="0.3">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_settings_max_tokens">最大 Token</label>
                                            <input type="number" id="cfg-llm-maxtokens" min="1" placeholder="2048">
                                        </div>
                                    </div>
                                    <div class="admin-form-row" style="margin-top:0.5rem;">
                                        <button type="button" class="btn-secondary btn-sm" id="btn-test-llm" onclick="window.testLLM()" data-i18n="admin_settings_test_llm">测试 LLM 连接</button>
                                        <span id="spinner-test-llm" class="inline-spinner hidden"></span>
                                        <span id="test-llm-result" class="admin-form-hint hidden"></span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_embedding">Embedding 配置</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_emb_endpoint">Embedding 端点</label>
                                        <input type="text" id="cfg-emb-endpoint" placeholder="https://api.openai.com/v1">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_emb_model">Embedding 模型</label>
                                        <input type="text" id="cfg-emb-model" placeholder="text-embedding-3-small">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_api_key">API 密钥</label>
                                        <div class="input-with-btn">
                                            <input type="password" id="cfg-emb-apikey" placeholder="***">
                                            <a href="https://console.volcengine.com/ark/" target="_blank" rel="noopener noreferrer" class="btn-secondary btn-sm" data-i18n="admin_settings_get_api_key">获取 API Key</a>
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_emb_multimodal">多模态嵌入</label>
                                        <select id="cfg-emb-multimodal">
                                            <option value="false" data-i18n="admin_settings_emb_multimodal_no">否（标准 /embeddings）</option>
                                            <option value="true" data-i18n="admin_settings_emb_multimodal_yes">是（/embeddings/multimodal）</option>
                                        </select>
                                        <span class="admin-form-hint" data-i18n="admin_settings_emb_multimodal_hint">豆包视觉嵌入模型需开启此选项</span>
                                    </div>
                                    <div class="admin-form-row" style="margin-top:0.5rem;">
                                        <button type="button" class="btn-secondary btn-sm" id="btn-test-embedding" onclick="window.testEmbedding()" data-i18n="admin_settings_test_embedding">测试 Embedding 连接</button>
                                        <span id="spinner-test-embedding" class="inline-spinner hidden"></span>
                                        <span id="test-embedding-result" class="admin-form-hint hidden"></span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_vector">向量配置</legend>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_chunk_size">分块大小</label>
                                            <input type="number" id="cfg-vec-chunksize" min="1" placeholder="512">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_settings_overlap">重叠大小</label>
                                            <input type="number" id="cfg-vec-overlap" min="0" placeholder="128">
                                        </div>
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_topk">Top-K</label>
                                            <input type="number" id="cfg-vec-topk" min="1" placeholder="5">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_settings_threshold">相似度阈值</label>
                                            <input type="number" id="cfg-vec-threshold" step="0.01" min="0" max="1" placeholder="0.7">
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_content_priority">内容优先级</label>
                                        <select id="cfg-vec-content-priority">
                                            <option value="image_text" data-i18n="admin_settings_priority_image">优先图文（有图片的结果优先）</option>
                                            <option value="text_only" data-i18n="admin_settings_priority_text">优先纯文字（纯文本结果优先）</option>
                                        </select>
                                        <span class="admin-form-hint" data-i18n="admin_settings_priority_hint">设置回答时优先使用图文内容还是纯文字内容</span>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_text_match">三级文本匹配</label>
                                        <select id="cfg-vec-text-match">
                                            <option value="true" data-i18n="admin_settings_text_match_on">开启（优先文本匹配，节省 API 费用）</option>
                                            <option value="false" data-i18n="admin_settings_text_match_off">关闭（始终使用完整 RAG 流程）</option>
                                        </select>
                                        <span class="admin-form-hint" data-i18n="admin_settings_text_match_hint">开启后查询按3级处理：1级纯文本匹配（免费）→ 2级向量确认+缓存复用（仅嵌入费用）→ 3级完整RAG（嵌入+LLM费用）</span>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_debug_mode">调试模式</label>
                                        <select id="cfg-vec-debug-mode">
                                            <option value="false" data-i18n="admin_settings_debug_off">关闭</option>
                                            <option value="true" data-i18n="admin_settings_debug_on">开启（查询结果附带诊断信息）</option>
                                        </select>
                                        <span class="admin-form-hint" data-i18n="admin_settings_debug_hint">开启后聊天回复会显示三级搜索的详细过程，方便排查问题</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_smtp">邮件服务器 (SMTP)</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_smtp_host">SMTP 服务器</label>
                                        <input type="text" id="cfg-smtp-host" placeholder="smtp.example.com">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_smtp_port">端口</label>
                                            <input type="number" id="cfg-smtp-port" placeholder="587">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_settings_smtp_tls">使用 TLS</label>
                                            <select id="cfg-smtp-tls">
                                                <option value="true" data-i18n="admin_settings_smtp_tls_yes">是</option>
                                                <option value="false" data-i18n="admin_settings_smtp_tls_no">否</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_smtp_username">用户名</label>
                                        <input type="text" id="cfg-smtp-username" placeholder="user@example.com">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_smtp_password">密码</label>
                                        <input type="password" id="cfg-smtp-password" placeholder="***">
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_settings_smtp_from_addr">发件人地址</label>
                                            <input type="text" id="cfg-smtp-from-addr" placeholder="noreply@example.com">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_settings_smtp_from_name">发件人名称</label>
                                            <input type="text" id="cfg-smtp-from-name" placeholder="软件自助服务平台">
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_smtp_test">测试发送</label>
                                        <div style="display:flex;gap:0.5rem;">
                                            <input type="email" id="cfg-smtp-test-email" data-i18n-placeholder="admin_settings_smtp_test_placeholder" placeholder="收件人邮箱" style="flex:1;">
                                            <button class="btn-secondary" id="smtp-test-btn" onclick="testSmtpEmail()" data-i18n="admin_settings_smtp_test_btn">发送测试邮件</button>
                                        </div>
                                        <p id="smtp-test-result" class="hidden" style="margin-top:0.5rem;font-size:0.85rem;"></p>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_admin">管理员设置</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_login_route">管理员登录路由</label>
                                        <input type="text" id="cfg-admin-login-route" placeholder="/admin">
                                        <span class="admin-form-hint" data-i18n="admin_settings_login_route_hint">访问此隐藏路由可进入管理员登录页面</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_oauth">OAuth 登录设置</legend>
                                    <span class="admin-form-hint" data-i18n="admin_settings_oauth_hint">配置第三方OAuth登录，设置完成后用户可在登录页看到对应的登录按钮</span>
                                    <div id="oauth-providers-list" class="oauth-providers-admin"></div>
                                    <div class="admin-form-row" style="margin-top:1rem;">
                                        <label data-i18n="admin_settings_oauth_add">添加 OAuth 平台</label>
                                        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                                            <select id="oauth-add-provider-select">
                                                <option value="google">Google</option>
                                                <option value="apple">Apple</option>
                                                <option value="amazon">Amazon</option>
                                                <option value="facebook">Facebook</option>
                                            </select>
                                            <button class="btn-secondary" onclick="addOAuthProviderForm()" data-i18n="admin_settings_oauth_add_btn">添加</button>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_product_name">产品名称</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_product_name_label">产品名称</label>
                                        <input type="text" id="cfg-product-name" data-i18n-placeholder="admin_settings_product_name_placeholder" placeholder="输入产品名称，如：XX自助服务系统">
                                        <span class="admin-form-hint" data-i18n="admin_settings_product_name_hint">设置后将自动显示在页面标题、登录页、聊天页等位置，并自动处理多语言翻译</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_settings_product_intro">产品介绍</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_product_intro_label">欢迎信息</label>
                                        <textarea id="cfg-product-intro" rows="4" data-i18n-placeholder="admin_settings_product_intro_placeholder" placeholder="输入产品简介，用户登录后将作为欢迎信息显示"></textarea>
                                        <span class="admin-form-hint" data-i18n="admin_settings_product_intro_hint">用户登录后在聊天页面显示此信息</span>
                                    </div>
                                </fieldset>

                                <div class="admin-form-actions">
                                    <button class="btn-primary" onclick="saveAdminSettings()" data-i18n="admin_settings_save">保存设置</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Knowledge Entry Tab -->
                    <div id="admin-tab-knowledge" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_knowledge_title">知识录入</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_knowledge_legend">录入图文知识</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_knowledge_product_label">目标产品</label>
                                        <select id="knowledge-product-select" class="login-product-select" style="width:100%;">
                                            <option value="" data-i18n="admin_doc_product_public">公共库</option>
                                        </select>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_knowledge_title_label">标题</label>
                                        <input type="text" id="knowledge-title" data-i18n-placeholder="admin_knowledge_title_placeholder" placeholder="知识条目标题">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_knowledge_content_label">内容</label>
                                        <textarea id="knowledge-content" rows="6" data-i18n-placeholder="admin_knowledge_content_placeholder" placeholder="输入知识内容（支持详细描述）"></textarea>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_knowledge_image_label">图片（可选）</label>
                                        <div id="knowledge-image-zone" class="knowledge-image-zone">
                                            <div class="knowledge-image-upload-area" id="knowledge-image-upload-area">
                                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                                                <p data-i18n="admin_knowledge_image_upload">点击上传图片、拖拽图片到此处，或从剪贴板粘贴</p>
                                                <span class="admin-drop-hint" data-i18n="admin_knowledge_image_hint">支持 JPG、PNG、GIF、WebP、BMP 格式</span>
                                                <input type="file" id="knowledge-image-input" accept="image/*" multiple style="display:none">
                                            </div>
                                            <div id="knowledge-image-preview" class="knowledge-image-preview"></div>
                                        </div>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_knowledge_video_label">视频（可选）</label>
                                        <div id="knowledge-video-zone" class="knowledge-video-zone">
                                            <div class="knowledge-video-upload-area" id="knowledge-video-upload-area">
                                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
                                                <p data-i18n="admin_knowledge_video_upload">点击上传视频、拖拽视频到此处，或从剪贴板粘贴</p>
                                                <span class="admin-drop-hint" data-i18n="admin_knowledge_video_hint">支持 MP4、AVI、MKV、MOV、WebM 格式</span>
                                                <input type="file" id="knowledge-video-input" accept="video/mp4,video/avi,video/x-msvideo,video/x-matroska,video/quicktime,video/webm" multiple style="display:none">
                                            </div>
                                            <div id="knowledge-video-preview" class="knowledge-video-preview"></div>
                                        </div>
                                    </div>
                                </fieldset>
                                <div class="admin-form-actions">
                                    <button class="btn-primary" id="knowledge-submit-btn" onclick="submitKnowledgeEntry()" data-i18n="admin_knowledge_submit">提交录入</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products Tab -->
                    <div id="admin-tab-products" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_products_title">产品管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_products_add_legend">添加产品</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_products_name">产品名称</label>
                                        <input type="text" id="product-new-name" data-i18n-placeholder="admin_products_name_placeholder" placeholder="输入产品名称">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_products_type">产品类型</label>
                                        <select id="product-new-type">
                                            <option value="service" data-i18n="admin_products_type_service">产品服务</option>
                                            <option value="knowledge_base" data-i18n="admin_products_type_knowledge">知识库</option>
                                        </select>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_products_desc">产品描述</label>
                                        <input type="text" id="product-new-desc" data-i18n-placeholder="admin_products_desc_placeholder" placeholder="输入产品描述（可选）">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_products_welcome">欢迎消息</label>
                                        <textarea id="product-new-welcome" rows="3" data-i18n-placeholder="admin_products_welcome_placeholder" placeholder="用户选择该产品后显示的欢迎消息（可选）"></textarea>
                                    </div>
                                    <div class="admin-form-actions">
                                        <button class="btn-primary" onclick="createProduct()" data-i18n="admin_products_add_btn">添加产品</button>
                                    </div>
                                </fieldset>
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_products_list_legend">产品列表</legend>
                                    <div id="admin-products-table-wrap">
                                        <table class="admin-table">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="admin_products_th_name">名称</th>
                                                    <th data-i18n="admin_products_th_type">类型</th>
                                                    <th data-i18n="admin_products_th_desc">描述</th>
                                                    <th data-i18n="admin_products_th_time">创建时间</th>
                                                    <th data-i18n="admin_products_th_action">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-products-tbody">
                                                <tr><td colspan="5" class="admin-table-empty" data-i18n="admin_products_empty">暂无产品</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>

                    <!-- Multimodal Tab (Video/Audio Processing) -->
                    <div id="admin-tab-multimodal" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_multimodal_title">多模态配置</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div id="admin-multimodal-form" class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_multimodal_dep_status">依赖状态</legend>
                                    <div id="multimodal-dep-status" class="admin-dep-status">
                                        <div class="admin-dep-item">
                                            <span class="admin-dep-icon" id="dep-ffmpeg-icon">⏳</span>
                                            <span>FFmpeg</span>
                                            <span class="admin-dep-label" id="dep-ffmpeg-label" data-i18n="admin_multimodal_checking">检测中...</span>
                                        </div>
                                        <div class="admin-dep-item">
                                            <span class="admin-dep-icon" id="dep-rapidspeech-icon">⏳</span>
                                            <span>RapidSpeech</span>
                                            <span class="admin-dep-label" id="dep-rapidspeech-label" data-i18n="admin_multimodal_checking">检测中...</span>
                                        </div>
                                    </div>
                                    <div class="admin-form-row" style="margin-top:0.5rem;">
                                        <button type="button" class="btn-secondary btn-sm" onclick="checkMultimodalDeps()" data-i18n="admin_multimodal_recheck">重新检测</button>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_multimodal_ffmpeg">FFmpeg 配置</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_multimodal_ffmpeg_path">FFmpeg 路径</label>
                                        <input type="text" id="cfg-video-ffmpeg-path" placeholder="ffmpeg">
                                        <span class="admin-form-hint" data-i18n="admin_multimodal_ffmpeg_path_hint">留空则使用系统 PATH 中的 ffmpeg，也可填写完整路径如 /usr/bin/ffmpeg</span>
                                    </div>
                                    <div class="admin-install-guide">
                                        <details>
                                            <summary data-i18n="admin_multimodal_ffmpeg_install">📦 FFmpeg 安装指南</summary>
                                            <div class="admin-install-content">
                                                <p data-i18n="admin_multimodal_ffmpeg_desc">FFmpeg 用于从视频中提取音频和关键帧图像。</p>
                                                <div class="admin-install-os">
                                                    <h4>Windows</h4>
                                                    <ol>
                                                        <li data-i18n-html="admin_multimodal_ffmpeg_win1">访问 <a href="https://www.gyan.dev/ffmpeg/builds/" target="_blank" rel="noopener">gyan.dev/ffmpeg</a> 下载 release full 版本</li>
                                                        <li data-i18n-html="admin_multimodal_ffmpeg_win2">解压到任意目录，如 <code>C:\ffmpeg</code></li>
                                                        <li data-i18n-html="admin_multimodal_ffmpeg_win3">将 <code>C:\ffmpeg\bin</code> 添加到系统环境变量 PATH 中</li>
                                                        <li data-i18n-html="admin_multimodal_ffmpeg_win4">或直接在上方填写完整路径：<code>C:\ffmpeg\bin\ffmpeg.exe</code></li>
                                                    </ol>
                                                    <p data-i18n-html="admin_multimodal_ffmpeg_win_alt">也可使用包管理器：<code>winget install ffmpeg</code> 或 <code>choco install ffmpeg</code></p>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4>macOS</h4>
                                                    <code class="admin-install-cmd">brew install ffmpeg</code>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4>Linux (Ubuntu/Debian)</h4>
                                                    <code class="admin-install-cmd">sudo apt update && sudo apt install ffmpeg</code>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4>Linux (CentOS/RHEL)</h4>
                                                    <code class="admin-install-cmd">sudo yum install ffmpeg</code>
                                                </div>
                                                <p data-i18n-html="admin_multimodal_ffmpeg_verify">安装后可在终端运行 <code>ffmpeg -version</code> 验证是否安装成功。</p>
                                            </div>
                                        </details>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_multimodal_rapidspeech">RapidSpeech 配置</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_multimodal_rapidspeech_path">RapidSpeech 可执行文件路径</label>
                                        <input type="text" id="cfg-video-rapidspeech-path" placeholder="/usr/local/bin/rs-asr-offline">
                                        <span class="admin-form-hint" data-i18n="admin_multimodal_rapidspeech_path_hint">填写 rs-asr-offline 的完整路径</span>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_multimodal_rapidspeech_model">RapidSpeech 模型文件路径</label>
                                        <input type="text" id="cfg-video-rapidspeech-model" placeholder="/path/to/model.gguf">
                                        <span class="admin-form-hint" data-i18n="admin_multimodal_rapidspeech_model_hint">填写模型文件（model.gguf）的完整路径</span>
                                    </div>
                                    <div class="admin-install-guide">
                                        <details>
                                            <summary data-i18n="admin_multimodal_rapidspeech_install">📦 RapidSpeech.cpp 安装指南</summary>
                                            <div class="admin-install-content">
                                                <p data-i18n="admin_multimodal_rapidspeech_desc">RapidSpeech.cpp 是基于 ggml 的 C++ 语音识别框架</p>
                                                <div class="admin-install-os">
                                                    <h4 data-i18n="admin_multimodal_rapidspeech_step1_title">步骤 1：编译程序</h4>
                                                    <p data-i18n-html="admin_multimodal_rapidspeech_step1_desc">克隆仓库并编译</p>
                                                    <p data-i18n-html="admin_multimodal_rapidspeech_step1_note">编译后可执行文件位于 build/rs-asr-offline</p>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4 data-i18n="admin_multimodal_rapidspeech_step2_title">步骤 2：下载模型文件</h4>
                                                    <p data-i18n-html="admin_multimodal_rapidspeech_step2_desc">从 Hugging Face 或 ModelScope 下载 GGUF 格式模型文件</p>
                                                    <p data-i18n="admin_multimodal_rapidspeech_step2_note">支持多种量化版本，推荐 Q5</p>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4 data-i18n="admin_multimodal_rapidspeech_step3_title">步骤 3：配置路径</h4>
                                                    <p data-i18n="admin_multimodal_rapidspeech_step3_desc">在上方填写可执行文件和模型文件的完整路径即可</p>
                                                </div>
                                                <div class="admin-install-os">
                                                    <h4 data-i18n="admin_multimodal_rapidspeech_note_title">⚠️ 注意事项</h4>
                                                    <ul>
                                                        <li data-i18n="admin_multimodal_rapidspeech_note1">RapidSpeech 依赖 FFmpeg 提取音频</li>
                                                        <li data-i18n="admin_multimodal_rapidspeech_note2">C++ 实现，支持 CPU/GPU/NPU 加速</li>
                                                        <li data-i18n="admin_multimodal_rapidspeech_note3">单一二进制文件，零依赖</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </details>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_multimodal_video">视频处理参数</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_multimodal_keyframe_interval">关键帧抽取间隔（秒）</label>
                                        <input type="number" id="cfg-video-keyframe-interval" min="1" max="300" placeholder="10">
                                        <span class="admin-form-hint" data-i18n="admin_multimodal_keyframe_hint">每隔多少秒从视频中提取一帧图像用于图像检索，默认 10 秒</span>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_multimodal_max_upload_size">文件上传大小限制（MB）</label>
                                        <input type="number" id="cfg-video-max-upload-size" min="1" max="10240" placeholder="500">
                                        <span class="admin-form-hint" data-i18n="admin_multimodal_max_upload_hint">视频和文档上传的最大文件大小，默认 500MB</span>
                                    </div>
                                </fieldset>

                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_multimodal_supported">支持的视频格式</legend>
                                    <p class="admin-form-hint" style="margin:0;" data-i18n="admin_multimodal_formats">MP4、AVI、MKV、MOV、WebM</p>
                                    <p class="admin-form-hint" style="margin-top:0.5rem;" data-i18n="admin_multimodal_workflow">上传视频后，系统将自动：1) 使用 FFmpeg 提取音频和关键帧 → 2) 使用 Whisper 将语音转为文字 → 3) 对文字和图像分别生成向量嵌入 → 4) 存入知识库供检索</p>
                                </fieldset>

                                <div class="admin-form-actions">
                                    <button class="btn-primary" onclick="saveMultimodalSettings()" data-i18n="admin_multimodal_save">保存多模态设置</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Users Tab -->
                    <div id="admin-tab-users" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_users_title">用户管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_users_add_legend">添加管理员账号</legend>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_users_username">用户名</label>
                                        <input type="text" id="admin-new-username" data-i18n-placeholder="admin_users_username" placeholder="用户名">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_settings_smtp_password">密码</label>
                                        <input type="password" id="admin-new-password" data-i18n-placeholder="admin_users_password" placeholder="密码（至少6位）">
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_users_role">角色</label>
                                        <select id="admin-new-role">
                                            <option value="editor" data-i18n="admin_users_role_editor">编辑员（内容管理/问题回答）</option>
                                            <option value="super_admin" data-i18n="admin_users_role_super">超级管理员（全部权限）</option>
                                        </select>
                                        <span class="admin-form-hint" data-i18n="admin_users_role_hint">编辑员仅可管理文档、回答问题和录入知识，不能修改系统设置和管理用户</span>
                                    </div>
                                    <div class="admin-form-row">
                                        <label data-i18n="admin_users_products">关联产品</label>
                                        <div id="admin-new-products-checkboxes" class="admin-checkbox-group">
                                            <span class="admin-form-hint" data-i18n="admin_users_products_loading">加载中...</span>
                                        </div>
                                        <span class="admin-form-hint" data-i18n="admin_users_products_hint">选择该用户可管理的产品，不选则可管理所有产品</span>
                                    </div>
                                    <div class="admin-form-actions">
                                        <button class="btn-primary" onclick="createAdminUser()" data-i18n="admin_users_add_btn">添加用户</button>
                                    </div>
                                </fieldset>
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_users_list_legend">管理员账号列表</legend>
                                    <div id="admin-users-table-wrap">
                                        <table class="admin-table">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="admin_users_th_username">用户名</th>
                                                    <th data-i18n="admin_users_th_role">角色</th>
                                                    <th data-i18n="admin_users_th_products">关联产品</th>
                                                    <th data-i18n="admin_users_th_time">创建时间</th>
                                                    <th data-i18n="admin_users_th_action">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-users-tbody">
                                                <tr><td colspan="5" class="admin-table-empty" data-i18n="admin_users_empty">暂无子账号</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>

                    <!-- Login Bans Tab -->
                    <div id="admin-tab-bans" class="admin-tab hidden">
                        <div class="admin-tab-header">
                            <h2 data-i18n="admin_bans_title">登录限制管理</h2>
                        </div>
                        <div class="admin-tab-body">
                            <div class="admin-settings-form">
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_bans_add_legend">手动添加限制</legend>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_bans_username">用户名（可选）</label>
                                            <input type="text" id="ban-new-username" data-i18n-placeholder="admin_bans_username_placeholder" placeholder="要封禁的用户名">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_bans_ip">IP 地址（可选）</label>
                                            <input type="text" id="ban-new-ip" data-i18n-placeholder="admin_bans_ip_placeholder" placeholder="要封禁的IP地址">
                                        </div>
                                    </div>
                                    <div class="admin-form-row admin-form-row-half">
                                        <div>
                                            <label data-i18n="admin_bans_reason">封禁原因</label>
                                            <input type="text" id="ban-new-reason" data-i18n-placeholder="admin_bans_reason_placeholder" placeholder="封禁原因（可选）">
                                        </div>
                                        <div>
                                            <label data-i18n="admin_bans_days">封禁天数</label>
                                            <input type="number" id="ban-new-days" min="1" max="365" value="1" placeholder="1">
                                        </div>
                                    </div>
                                    <div class="admin-form-actions">
                                        <button class="btn-primary" onclick="addLoginBan()" data-i18n="admin_bans_add_btn">添加限制</button>
                                    </div>
                                </fieldset>
                                <fieldset class="admin-fieldset">
                                    <legend data-i18n="admin_bans_list_legend">当前登录限制列表</legend>
                                    <div id="admin-bans-table-wrap">
                                        <table class="admin-table">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="admin_bans_th_type">类型</th>
                                                    <th data-i18n="admin_bans_th_target">目标</th>
                                                    <th data-i18n="admin_bans_th_reason">原因</th>
                                                    <th data-i18n="admin_bans_th_fails">失败次数</th>
                                                    <th data-i18n="admin_bans_th_unlocks">解锁时间</th>
                                                    <th data-i18n="admin_bans_th_action">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-bans-tbody">
                                                <tr><td colspan="6" class="admin-table-empty" data-i18n="admin_bans_empty">暂无登录限制</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Delete Confirmation Dialog -->
            <div id="admin-confirm-dialog" class="admin-dialog-overlay hidden">
                <div class="admin-dialog">
                    <h3 data-i18n="admin_delete_title">确认删除</h3>
                    <p id="admin-confirm-msg" data-i18n="admin_delete_default_msg">确定要删除该文档吗？此操作不可撤销。</p>
                    <div class="admin-dialog-actions">
                        <button class="btn-secondary" onclick="closeAdminDialog()" data-i18n="admin_delete_cancel">取消</button>
                        <button class="btn-danger" id="admin-confirm-btn" onclick="confirmAdminDelete()" data-i18n="admin_delete_confirm">删除</button>
                    </div>
                </div>
            </div>

            <!-- Answer Dialog -->
            <div id="admin-answer-dialog" class="admin-dialog-overlay hidden">
                <div class="admin-dialog admin-dialog-wide">
                    <h3 data-i18n="admin_answer_title">回答问题</h3>
                    <div class="admin-answer-question" id="admin-answer-question-text"></div>
                    <div class="admin-form-row">
                        <label data-i18n="admin_answer_text_label">文字回答</label>
                        <textarea id="admin-answer-text" rows="4" data-i18n-placeholder="admin_answer_text_placeholder" placeholder="输入回答内容"></textarea>
                    </div>
                    <div class="admin-form-row">
                        <label data-i18n="admin_answer_image_label">图片（可选，支持粘贴/拖拽/点击上传）</label>
                        <div id="answer-image-upload-area" class="upload-area upload-area-sm">
                            <input type="file" id="answer-image-input" accept="image/*" multiple hidden>
                            <span data-i18n="admin_answer_image_upload">点击选择图片，或拖拽/粘贴图片到此处</span>
                        </div>
                        <div id="answer-image-preview" class="knowledge-image-preview"></div>
                    </div>
                    <div class="admin-form-row">
                        <label data-i18n="admin_answer_url_label">相关URL（可选）</label>
                        <input type="text" id="admin-answer-url" placeholder="https://...">
                    </div>
                    <div class="admin-dialog-actions">
                        <button class="btn-secondary" onclick="closeAnswerDialog()" data-i18n="admin_answer_cancel">取消</button>
                        <button class="btn-primary" id="admin-answer-submit-btn" onclick="submitAdminAnswer()" data-i18n="admin_answer_submit">提交回答</button>
                    </div>
                </div>
            </div>

            <div id="admin-toast" class="toast hidden"></div>
        </div>
    </div>

    <script src="/app.js?v=20260212-4"></script>
    <script>
        // Apply i18n translations on page load
        if (window.i18n) {
            window.i18n.applyI18nToPage();
        }
    </script>
</body>
</html>
